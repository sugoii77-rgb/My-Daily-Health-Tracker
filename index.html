// ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ë°±ì—…)
        function exportData() {
            try {
                const currentData = localStorage.getItem('dietDiary');
                const historyData = localStorage.getItem('dietDiaryHistory');
                
                if (!currentData && !historyData) {
                    alert('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const exportData = {
                    currentData: currentData ? JSON.parse(currentData) : null,
                    historyData: historyData ? JSON.parse(historyData) : [],
                    exportDate: new Date().toISOString(),
                    version: '2.0'
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                    type: 'application/json' 
                });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `diet-diary-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('ë°ì´í„°ê°€ ë‹¤ìš´ë¡œë“œ í´ë”ì— ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³µì›)
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // ë°±ì—… íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
                    if (!importedData.currentData && !importedData.historyData) {
                        alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°±ì—… íŒŒì¼ì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    // ê¸°ì¡´ ë°ì´í„° ë®ì–´ì“°ê¸° í™•ì¸
                    if (localStorage.getItem('dietDiary') || localStorage.getItem('dietDiaryHistory')) {
                        if (!confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            return;
                        }
                    }
                    
                    // ë°ì´í„° ë³µì›
                    if (importedData.currentData) {
                        localStorage.setItem('dietDiary', JSON.stringify(importedData.currentData));
                    }
                    if (importedData.historyData) {
                        localStorage.setItem('dietDiaryHistory', JSON.stringify(importedData.historyData));
                    }
                    
                    loadData();
                    alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                } catch (error) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }        function saveData() {
            const today = new Date().toDateString();
            let totalCalories = 0;
            
            const data = {
                date: today,
                timestamp: new Date().toISOString(),
                meals: {},
                water: document.querySelectorAll('.water-cup.filled').length,
                weight: document.getElementById('weight').value,
                sleep: document.getElementById('sleep').value,
                energy: document.getElementById('energyLevel').value,
                exercise: document.getElementById('exercise').value,
                dailyNote: document.getElementById('dailyNote').value,
                weeklyNote: document.getElementById('weeklyNote').value,
                weeklyPlan: {}
            };

            // ì‹ì‚¬ ë°ì´í„° ì €ì¥
            document.querySelectorAll('.meal-section').forEach(section => {
                const meal = section.dataset.meal;
                const calories = parseInt(section.querySelector('[data-field="calories"]').value) || 0;
                totalCalories += calories;
                
                data.meals[meal] = {
                    food: section.querySelector('[data-field="food"]').value,
                    calories: calories,
                    mood: section.querySelector('.mood-icon.selected')?.dataset.mood || null,
                    memo: section.querySelector('[data-field="memo"]').value
                };
            });
            
            data.totalCalories = totalCalories;

            // ì£¼ê°„ ê³„íš ë°ì´í„° ì €ì¥
            document.querySelectorAll('#weeklyTable input').forEach(input => {
                const day = input.dataset.day;
                const meal = input.dataset.meal;
                if (!data.weeklyPlan[day]) data.weeklyPlan[day] = {};
                data.weeklyPlan[day][meal] = input.value;
            });

            // íˆìŠ¤í† ë¦¬ ë°ì´í„° ì €ì¥ (ë¶„ì„ìš©)
            let historyData = JSON.parse(localStorage.getItem('dietDiaryHistory') || '[]');
            
            // ì˜¤ëŠ˜ ë°ì´í„°ê°€ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
            const existingIndex = historyData.findIndex(entry => entry.date === today);
            
            if (existingIndex >= 0) {
                // ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸
                historyData[existingIndex] = data;
            } else {
                // ìƒˆ ë°ì´í„° ì¶”ê°€
                historyData.push(data);
            }
            
            // 30ì¼ ì´ìƒ ëœ ë°ì´í„°ëŠ” ì‚­ì œ (ì„±ëŠ¥ ìµœì í™”)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            historyData = historyData.filter(entry => new Date(entry.date) >= thirtyDaysAgo);

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            try {
                localStorage.setItem('dietDiary', JSON.stringify(data));
                localStorage.setItem('dietDiaryHistory', JSON.stringify(historyData));
                console.log('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.log('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¼ë¶€ ë°ì´í„°ë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.');
            }
        }        function updateTotalCalories() {
            let totalCalories = 0;
            
            document.querySelectorAll('.meal-section').forEach(section => {
                const caloriesInput = section.querySelector('[data-field="calories"]');
                const calories = parseInt(caloriesInput.value) || 0;
                totalCalories += calories;
            });
            
            document.getElementById('totalCalories').textContent = totalCalories + ' kcal';
        }        <!-- ë°ì´í„° ë¶„ì„ í™”ë©´ -->
        <div id="analyticsView" class="hidden space-y-6">
            <!-- ë¶„ì„ ê¸°ê°„ ì„ íƒ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ“Š ë°ì´í„° ë¶„ì„</h3>
                <div class="flex gap-4 mb-4">
                    <button id="weeklyAnalysis" class="analysis-period-btn px-4 py-2 bg-purple-600 text-white rounded-lg active">
                        ğŸ“… ì§€ë‚œ 7ì¼ (ì¼ë³„)
                    </button>
                    <button id="monthlyAnalysis" class="analysis-period-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg">
                        ğŸ“ˆ ì§€ë‚œ 4ì£¼ (ì£¼ë³„)
                    </button>
                </div>
            </div>

            <!-- ì¹¼ë¡œë¦¬ ì„­ì·¨ ë¶„ì„ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h4 class="text-md font-semibold text-purple-700 mb-4">ğŸ”¥ ì¹¼ë¡œë¦¬ ì„­ì·¨ ë¶„ì„</h4>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <canvas id="caloriesChart" width="400" height="200"></canvas>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <div class="text-sm text-purple-600">í‰ê·  ì¼ì¼ ì¹¼ë¡œë¦¬</div>
                            <div class="text-2xl font-bold text-purple-800" id="avgCalories">0 kcal</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <div class="text-sm text-orange-600">ìµœê³  ì¹¼ë¡œë¦¬</div>
                            <div class="text-xl font-bold text-orange-800" id="maxCalories">0 kcal</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-sm text-green-600">ìµœì € ì¹¼ë¡œë¦¬</div>
                            <div class="text-xl font-bold text-green-800" id="minCalories">0 kcal</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìˆ˜ë¶„ ì„­ì·¨ ë¶„ì„ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h4 class="text-md font-semibold text-purple-700 mb-4">ğŸ’§ ìˆ˜ë¶„ ì„­ì·¨ ë¶„ì„</h4>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <canvas id="waterChart" width="400" height="200"></canvas>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-sm text-blue-600">í‰ê·  ì¼ì¼ ìˆ˜ë¶„</div>
                            <div class="text-2xl font-bold text-blue-800" id="avgWater">0 ml</div>
                        </div>
                        <div class="bg-cyan-50 p-4 rounded-lg">
                            <div class="text-sm text-cyan-600">ê¶Œì¥ëŸ‰ ë‹¬ì„±ë¥ </div>
                            <div class="text-xl font-bold text-cyan-800" id="waterGoalRate">0%</div>
                        </div>
                        <div class="bg-teal-50 p-4 rounded-lg">
                            <div class="text-sm text-teal-600">ëª©í‘œ: 2000ml</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-teal-600 h-2 rounded-full" style="width: 0%" id="waterProgress"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì²´ì¤‘ ë³€í™” ë¶„ì„ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h4 class="text-md font-semibold text-purple-700 mb-4">âš–ï¸ ì²´ì¤‘ ë³€í™” ë¶„ì„</h4>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <canvas id="weightChart" width="400" height="200"></canvas>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <div class="text-sm text-indigo-600">ì²´ì¤‘ ë³€í™”</div>
                            <div class="text-xl font-bold text-indigo-800" id="weightChange">0 kg</div>
                        </div>
                        <div class="bg-pink-50 p-4 rounded-lg">
                            <div class="text-sm text-pink-600">ëª©í‘œê¹Œì§€</div>
                            <div class="text-xl font-bold text-pink-800" id="weightToGoal">ëª©í‘œ ì„¤ì • í•„ìš”</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì¢…í•© ì ìˆ˜ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h4 class="text-md font-semibold text-purple-700 mb-4">ğŸ† ì¢…í•© ê±´ê°• ì ìˆ˜</h4>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="text-center p-4 bg-gradient-to-br from-purple-100 to-pink-100 rounded-lg">
                        <div class="text-3xl font-bold text-purple-800" id="overallScore">85</div>
                        <div class="text-sm text-purple-600">ì¢…í•© ì ìˆ˜</div>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-blue-100 to-cyan-100 rounded-lg">
                        <div class="text-2xl font-bold text-blue-800" id="hydrationScore">90</div>
                        <div class="text-sm text-blue-600">ìˆ˜ë¶„ ì ìˆ˜</div>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-green-100 to-emerald-100 rounded-lg">
                        <div class="text-2xl font-bold text-green-800" id="consistencyScore">75</div>
                        <div class="text-sm text-green-600">ê¾¸ì¤€í•¨ ì ìˆ˜</div>
                    </div>
                    <div class="text-center p-4 bg-gradient-to-br from-orange-100 to-yellow-100 rounded-lg">
                        <div class="text-2xl font-bold text-orange-800" id="balanceScore">80</div>
                        <div class="text-sm text-orange-600">ê· í˜• ì ìˆ˜</div>
                    </div>
                </div>
            </div>
        </div><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤ì´ì–´íŠ¸ ë‹¤ì´ì–´ë¦¬</title>
    
    <!-- PWA ì„¤ì • -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIu2WtOydtOyWtO2KuCDri6TsnbzslrTrpqwiLAogICJzaG9ydF9uYW1lIjogIu2WtOydtOyWtCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qWXdJaUJvWldsbmFIUTlJakkyTUNJZ2RtbGxkMEp2ZUQwaU1DQXdJREkyTUNBeU5qQWlJR1pwYkd3OUlpTnpaVE0yT1RSaUlpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaVBpQThZMmx5WTJ4bElHTjRQU0l4TXpBaUlHTjVQU0l4TXpBaUlISTlJak13SWlCbWFXeHNQU0lqWlRnM09XWTVJaTgrUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiMjU2eDI1NiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXSwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmNWYzZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjZTg3OWY5Igp9">
    <meta name="theme-color" content="#e879f9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ë‹¤ì´ì–´íŠ¸ ë‹¤ì´ì–´ë¦¬">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f5f3ff 0%, #fef7f0 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .clock-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        
        .clock-face {
            width: 100%;
            height: 100%;
            border: 3px solid #e879f9;
            border-radius: 50%;
            position: relative;
            background: white;
        }
        
        .clock-number {
            position: absolute;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #6b21a8;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .clock-number:hover {
            background: #f3e8ff;
            transform: scale(1.1);
        }
        
        .clock-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: #e879f9;
            border-radius: 50%;
        }
        
        .water-cup {
            width: 40px;
            height: 50px;
            border: 2px solid #06b6d4;
            border-radius: 0 0 8px 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .water-cup.filled {
            background: linear-gradient(to top, #06b6d4 0%, #67e8f9 100%);
        }
        
        .mood-icon {
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .mood-icon:hover {
            background: #f3e8ff;
            transform: scale(1.1);
        }
        
        .mood-icon.selected {
            background: #e879f9;
            color: white;
        }
        
        .energy-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e5e7eb;
            outline: none;
        }
        
        .energy-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e879f9;
            cursor: pointer;
        }
        
        .tab-button {
            transition: all 0.3s;
        }
        
        .tab-button.active {
            background: #e879f9;
            color: white;
        }
        
        .meal-time-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <!-- í—¤ë” -->
        <div class="glass-card rounded-lg p-6 mb-6 shadow-lg">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold text-purple-800">ğŸ’œ ë‹¤ì´ì–´íŠ¸ ë‹¤ì´ì–´ë¦¬</h1>
                <div class="flex gap-4">
                    <button id="exportBtn" class="px-4 py-2 bg-green-200 text-green-800 rounded-lg hover:bg-green-300 transition-all">
                        ğŸ’¾ ë°±ì—…
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                    <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 bg-blue-200 text-blue-800 rounded-lg hover:bg-blue-300 transition-all">
                        ğŸ“ ë³µì›
                    </button>
                    <button id="langBtn" class="px-4 py-2 bg-purple-200 text-purple-800 rounded-lg hover:bg-purple-300 transition-all">
                        ğŸŒ EN
                    </button>
                    <button id="resetBtn" class="px-4 py-2 bg-red-200 text-red-800 rounded-lg hover:bg-red-300 transition-all">
                        ğŸ”„ ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="glass-card rounded-lg p-4 mb-6 shadow-lg">
            <div class="flex gap-2 overflow-x-auto">
                <button id="dailyTab" class="tab-button px-4 py-2 rounded-lg font-semibold active whitespace-nowrap">
                    ğŸ“† ì˜¤ëŠ˜ì˜ ë‹¤ì§
                </button>
                <button id="weeklyTab" class="tab-button px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-700 whitespace-nowrap">
                    ğŸ“… 7ì¼ ì‹ë‹¨ ê³„íš
                </button>
                <button id="analyticsTab" class="tab-button px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-700 whitespace-nowrap">
                    ğŸ“Š ë°ì´í„° ë¶„ì„
                </button>
            </div>
        </div>

        <!-- ë°ì¼ë¦¬ í™”ë©´ -->
        <div id="dailyView" class="space-y-6">
            <!-- ë‚ ì§œ í‘œì‹œ -->
            <div class="glass-card rounded-lg p-4 shadow-lg">
                <h2 class="text-xl font-bold text-purple-800 mb-2" id="currentDate"></h2>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- 24ì‹œê°„ ì›í˜• ì‹œê³„ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ• ì‹ì‚¬ ì‹œê°„ ê¸°ë¡</h3>
                    <div class="clock-container">
                        <div class="clock-face" id="clockFace">
                            <div class="clock-center"></div>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <p class="text-sm text-gray-600">ì‹œê°„ì„ í´ë¦­í•˜ì—¬ ì‹ì‚¬ ê¸°ë¡</p>
                    </div>
                </div>

                <!-- ë¬¼ ì„­ì·¨ëŸ‰ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ’§ ë¬¼ ì„­ì·¨ëŸ‰</h3>
                    <div class="grid grid-cols-4 gap-4 mb-4" id="waterCups">
                        <!-- ë¬¼ì»µë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="text-center">
                        <span class="text-lg font-bold text-blue-600" id="waterCount">0</span> / 8 ì»µ
                        <p class="text-sm text-gray-600">(ì´ <span id="waterTotal">0</span>ml)</p>
                    </div>
                </div>
            </div>

                <!-- ì‹ì‚¬ë³„ ê¸°ë¡ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ½ï¸ ì‹ì‚¬ ê¸°ë¡</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="meal-section" data-meal="breakfast">
                        <h4 class="font-semibold text-purple-700 mb-3">ğŸŒ… ì•„ì¹¨</h4>
                        <input type="text" placeholder="ìŒì‹ ì…ë ¥" class="w-full p-2 border rounded-lg mb-2" data-field="food">
                        <input type="number" placeholder="ì¹¼ë¡œë¦¬ (kcal)" class="w-full p-2 border rounded-lg mb-2" data-field="calories">
                        <div class="flex gap-1 mb-2" data-field="mood">
                            <span class="mood-icon" data-mood="1">ğŸ˜£</span>
                            <span class="mood-icon" data-mood="2">ğŸ˜</span>
                            <span class="mood-icon" data-mood="3">ğŸ™‚</span>
                            <span class="mood-icon" data-mood="4">ğŸ˜‹</span>
                        </div>
                        <textarea placeholder="ë©”ëª¨" class="w-full p-2 border rounded-lg text-sm" rows="2" data-field="memo"></textarea>
                    </div>
                    
                    <div class="meal-section" data-meal="lunch">
                        <h4 class="font-semibold text-purple-700 mb-3">â˜€ï¸ ì ì‹¬</h4>
                        <input type="text" placeholder="ìŒì‹ ì…ë ¥" class="w-full p-2 border rounded-lg mb-2" data-field="food">
                        <input type="number" placeholder="ì¹¼ë¡œë¦¬ (kcal)" class="w-full p-2 border rounded-lg mb-2" data-field="calories">
                        <div class="flex gap-1 mb-2" data-field="mood">
                            <span class="mood-icon" data-mood="1">ğŸ˜£</span>
                            <span class="mood-icon" data-mood="2">ğŸ˜</span>
                            <span class="mood-icon" data-mood="3">ğŸ™‚</span>
                            <span class="mood-icon" data-mood="4">ğŸ˜‹</span>
                        </div>
                        <textarea placeholder="ë©”ëª¨" class="w-full p-2 border rounded-lg text-sm" rows="2" data-field="memo"></textarea>
                    </div>
                    
                    <div class="meal-section" data-meal="snack">
                        <h4 class="font-semibold text-purple-700 mb-3">ğŸª ê°„ì‹</h4>
                        <input type="text" placeholder="ìŒì‹ ì…ë ¥" class="w-full p-2 border rounded-lg mb-2" data-field="food">
                        <input type="number" placeholder="ì¹¼ë¡œë¦¬ (kcal)" class="w-full p-2 border rounded-lg mb-2" data-field="calories">
                        <div class="flex gap-1 mb-2" data-field="mood">
                            <span class="mood-icon" data-mood="1">ğŸ˜£</span>
                            <span class="mood-icon" data-mood="2">ğŸ˜</span>
                            <span class="mood-icon" data-mood="3">ğŸ™‚</span>
                            <span class="mood-icon" data-mood="4">ğŸ˜‹</span>
                        </div>
                        <textarea placeholder="ë©”ëª¨" class="w-full p-2 border rounded-lg text-sm" rows="2" data-field="memo"></textarea>
                    </div>
                    
                    <div class="meal-section" data-meal="dinner">
                        <h4 class="font-semibold text-purple-700 mb-3">ğŸŒ™ ì €ë…</h4>
                        <input type="text" placeholder="ìŒì‹ ì…ë ¥" class="w-full p-2 border rounded-lg mb-2" data-field="food">
                        <input type="number" placeholder="ì¹¼ë¡œë¦¬ (kcal)" class="w-full p-2 border rounded-lg mb-2" data-field="calories">
                        <div class="flex gap-1 mb-2" data-field="mood">
                            <span class="mood-icon" data-mood="1">ğŸ˜£</span>
                            <span class="mood-icon" data-mood="2">ğŸ˜</span>
                            <span class="mood-icon" data-mood="3">ğŸ™‚</span>
                            <span class="mood-icon" data-mood="4">ğŸ˜‹</span>
                        </div>
                        <textarea placeholder="ë©”ëª¨" class="w-full p-2 border rounded-lg text-sm" rows="2" data-field="memo"></textarea>
                    </div>
                </div>
                
                <!-- ì¼ì¼ ì´ ì¹¼ë¡œë¦¬ í‘œì‹œ -->
                <div class="mt-4 p-4 bg-purple-50 rounded-lg">
                    <div class="text-center">
                        <span class="text-sm text-purple-600">ì˜¤ëŠ˜ ì´ ì¹¼ë¡œë¦¬</span>
                        <div class="text-2xl font-bold text-purple-800" id="totalCalories">0 kcal</div>
                    </div>
                </div>
            </div>

            <!-- ê¸°íƒ€ ê¸°ë¡ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- ì²´ì¤‘ & ìˆ˜ë©´ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">âš–ï¸ ì²´ì¤‘ & ìˆ˜ë©´</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ì²´ì¤‘ (kg)</label>
                            <input type="number" step="0.1" placeholder="60.0" class="w-full p-2 border rounded-lg" id="weight">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ìˆ˜ë©´ ì‹œê°„</label>
                            <input type="number" step="0.5" placeholder="8.0" class="w-full p-2 border rounded-lg" id="sleep">
                        </div>
                    </div>
                </div>

                <!-- ì—ë„ˆì§€ ë ˆë²¨ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">âš¡ ì—ë„ˆì§€ ë ˆë²¨</h3>
                    <div class="space-y-4">
                        <input type="range" min="1" max="5" value="3" class="energy-slider" id="energyLevel">
                        <div class="flex justify-between text-xs text-gray-600">
                            <span>ğŸ˜´ í”¼ê³¤</span>
                            <span>ğŸ˜ ë³´í†µ</span>
                            <span>ğŸ˜Š ì¢‹ìŒ</span>
                            <span>ğŸ˜ í™œê¸°</span>
                            <span>ğŸ”¥ ìµœê³ </span>
                        </div>
                        <div class="text-center">
                            <span class="text-lg font-bold text-purple-600" id="energyText">ê¸°ë¶„ ì¢‹ìŒ</span>
                        </div>
                    </div>
                </div>

                <!-- ìš´ë™ ê¸°ë¡ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸƒâ€â™€ï¸ ìš´ë™ ê¸°ë¡</h3>
                    <textarea placeholder="ì˜¤ëŠ˜ í•œ ìš´ë™ì„ ê¸°ë¡í•´ë³´ì„¸ìš”" class="w-full p-2 border rounded-lg" rows="4" id="exercise"></textarea>
                </div>
            </div>

            <!-- ì˜¤ëŠ˜ì˜ ë…¸íŠ¸ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ“ ì˜¤ëŠ˜ì˜ ë…¸íŠ¸</h3>
                <textarea placeholder="ì˜¤ëŠ˜ì˜ ì†Œê°ì´ë‚˜ ë‹¤ì§ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”" class="w-full p-3 border rounded-lg" rows="4" id="dailyNote"></textarea>
            </div>
        </div>

        <!-- ì£¼ê°„ ê³„íš í™”ë©´ -->
        <div id="weeklyView" class="hidden">
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ“… 7ì¼ ì‹ë‹¨ ê³„íš</h3>
                
                <!-- ì£¼ê°„ í…Œì´ë¸” -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-purple-100">
                                <th class="border border-purple-200 p-3 text-purple-800">ë‚ ì§œ</th>
                                <th class="border border-purple-200 p-3 text-purple-800">ğŸŒ… ì•„ì¹¨</th>
                                <th class="border border-purple-200 p-3 text-purple-800">â˜€ï¸ ì ì‹¬</th>
                                <th class="border border-purple-200 p-3 text-purple-800">ğŸª ê°„ì‹</th>
                                <th class="border border-purple-200 p-3 text-purple-800">ğŸŒ™ ì €ë…</th>
                            </tr>
                        </thead>
                        <tbody id="weeklyTable">
                            <!-- í…Œì´ë¸” í–‰ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>

                <!-- ì£¼ê°„ ë©”ëª¨ -->
                <div class="mt-6">
                    <h4 class="text-md font-semibold text-purple-700 mb-2">ğŸ“‹ ì£¼ê°„ ë©”ëª¨</h4>
                    <textarea placeholder="ì´ë²ˆ ì£¼ ì‹ë‹¨ ê³„íšì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”" class="w-full p-3 border rounded-lg" rows="4" id="weeklyNote"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‹ì‚¬ ì‹œê°„ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="mealModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="glass-card rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold text-purple-800 mb-4" id="modalTitle">ì‹ì‚¬ ê¸°ë¡</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì‹œê°„</label>
                    <input type="time" class="w-full p-2 border rounded-lg" id="mealTime">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ìŒì‹</label>
                    <input type="text" placeholder="ë¨¹ì€ ìŒì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" class="w-full p-2 border rounded-lg" id="mealFood">
                </div>
                <div class="flex gap-4">
                    <button id="saveMeal" class="flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">ì €ì¥</button>
                    <button id="cancelMeal" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentLanguage = 'ko';
        let mealTimes = [];
        let caloriesChart, waterChart, weightChart;
        let currentAnalysisPeriod = 'weekly';
        
        // ì–¸ì–´ ë°ì´í„°
        const translations = {
            ko: {
                title: "ğŸ’œ ë‹¤ì´ì–´íŠ¸ ë‹¤ì´ì–´ë¦¬",
                dailyTab: "ğŸ“† ì˜¤ëŠ˜ì˜ ë‹¤ì§",
                weeklyTab: "ğŸ“… 7ì¼ ì‹ë‹¨ ê³„íš",
                clockTitle: "ğŸ• ì‹ì‚¬ ì‹œê°„ ê¸°ë¡",
                waterTitle: "ğŸ’§ ë¬¼ ì„­ì·¨ëŸ‰",
                mealTitle: "ğŸ½ï¸ ì‹ì‚¬ ê¸°ë¡",
                breakfast: "ğŸŒ… ì•„ì¹¨",
                lunch: "â˜€ï¸ ì ì‹¬",
                snack: "ğŸª ê°„ì‹",
                dinner: "ğŸŒ™ ì €ë…",
                weightSleep: "âš–ï¸ ì²´ì¤‘ & ìˆ˜ë©´",
                energy: "âš¡ ì—ë„ˆì§€ ë ˆë²¨",
                exercise: "ğŸƒâ€â™€ï¸ ìš´ë™ ê¸°ë¡",
                dailyNote: "ğŸ“ ì˜¤ëŠ˜ì˜ ë…¸íŠ¸"
            },
            en: {
                title: "ğŸ’œ Diet Diary",
                dailyTab: "ğŸ“† Today's Goal",
                weeklyTab: "ğŸ“… 7-Day Meal Plan",
                clockTitle: "ğŸ• Meal Time Record",
                waterTitle: "ğŸ’§ Water Intake",
                mealTitle: "ğŸ½ï¸ Meal Record",
                breakfast: "ğŸŒ… Breakfast",
                lunch: "â˜€ï¸ Lunch",
                snack: "ğŸª Snack",
                dinner: "ğŸŒ™ Dinner",
                weightSleep: "âš–ï¸ Weight & Sleep",
                energy: "âš¡ Energy Level",
                exercise: "ğŸƒâ€â™€ï¸ Exercise Record",
                dailyNote: "ğŸ“ Daily Note"
            }
        };

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            setupClock();
            setupWaterCups();
            setupWeeklyTable();
            setupEventListeners();
            loadDarkMode();
            loadData();
            updateCurrentDate();
        }

        function setupClock() {
            const clockFace = document.getElementById('clockFace');
            const radius = 85; // ì‹œê³„ ë°˜ì§€ë¦„
            const centerX = 100;
            const centerY = 100;

            for (let i = 1; i <= 24; i++) {
                const angle = (i * 15 - 90) * (Math.PI / 180); // 12ì‹œë¶€í„° ì‹œì‘
                const x = centerX + radius * Math.cos(angle) - 15;
                const y = centerY + radius * Math.sin(angle) - 15;

                const hourElement = document.createElement('div');
                hourElement.className = 'clock-number';
                hourElement.style.left = x + 'px';
                hourElement.style.top = y + 'px';
                hourElement.textContent = i;
                hourElement.addEventListener('click', () => openMealModal(i));

                clockFace.appendChild(hourElement);
            }
        }

        function setupWaterCups() {
            const waterCups = document.getElementById('waterCups');
            for (let i = 0; i < 8; i++) {
                const cup = document.createElement('div');
                cup.className = 'water-cup';
                cup.addEventListener('click', () => toggleWaterCup(i));
                waterCups.appendChild(cup);
            }
        }

        function setupWeeklyTable() {
            const tbody = document.getElementById('weeklyTable');
            const today = new Date();
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-purple-200 p-2 font-medium text-purple-700">
                        ${date.getMonth() + 1}/${date.getDate()} (${['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()]})
                    </td>
                    <td class="border border-purple-200 p-2">
                        <input type="text" class="w-full p-1 border-0 bg-transparent" data-day="${i}" data-meal="breakfast">
                    </td>
                    <td class="border border-purple-200 p-2">
                        <input type="text" class="w-full p-1 border-0 bg-transparent" data-day="${i}" data-meal="lunch">
                    </td>
                    <td class="border border-purple-200 p-2">
                        <input type="text" class="w-full p-1 border-0 bg-transparent" data-day="${i}" data-meal="snack">
                    </td>
                    <td class="border border-purple-200 p-2">
                        <input type="text" class="w-full p-1 border-0 bg-transparent" data-day="${i}" data-meal="dinner">
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function setupEventListeners() {
            // íƒ­ ì „í™˜
            document.getElementById('dailyTab').addEventListener('click', () => switchTab('daily'));
            document.getElementById('weeklyTab').addEventListener('click', () => switchTab('weekly'));
            document.getElementById('analyticsTab').addEventListener('click', () => switchTab('analytics'));
            
            // ë¶„ì„ ê¸°ê°„ ì „í™˜
            document.getElementById('weeklyAnalysis').addEventListener('click', () => switchAnalysisPeriod('weekly'));
            document.getElementById('monthlyAnalysis').addEventListener('click', () => switchAnalysisPeriod('monthly'));
            
            // ë°±ì—…/ë³µì› ë²„íŠ¼
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importFile').addEventListener('change', importData);
            
            // ì–¸ì–´ ì „í™˜
            document.getElementById('langBtn').addEventListener('click', toggleLanguage);
            
            // ì´ˆê¸°í™” ë²„íŠ¼
            document.getElementById('resetBtn').addEventListener('click', resetData);
            
            // ê¸°ë¶„ ì•„ì´ì½˜ í´ë¦­
            document.querySelectorAll('.mood-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const parent = this.parentElement;
                    parent.querySelectorAll('.mood-icon').forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    saveData();
                });
            });
            
            // ì—ë„ˆì§€ ìŠ¬ë¼ì´ë”
            document.getElementById('energyLevel').addEventListener('input', function() {
                updateEnergyText(this.value);
                saveData();
            });
            
            // ëª¨ë“  ì…ë ¥ í•„ë“œì— ìë™ ì €ì¥
            document.querySelectorAll('input, textarea').forEach(element => {
                element.addEventListener('input', function() {
                    saveData();
                    updateTotalCalories();
                });
            });
            
            // ëª¨ë‹¬ ì´ë²¤íŠ¸
            document.getElementById('saveMeal').addEventListener('click', saveMealTime);
            document.getElementById('cancelMeal').addEventListener('click', closeMealModal);
        }

        function switchTab(tab) {
            const dailyView = document.getElementById('dailyView');
            const weeklyView = document.getElementById('weeklyView');
            const analyticsView = document.getElementById('analyticsView');
            const dailyTab = document.getElementById('dailyTab');
            const weeklyTab = document.getElementById('weeklyTab');
            const analyticsTab = document.getElementById('analyticsTab');
            
            // ëª¨ë“  ë·° ìˆ¨ê¸°ê¸°
            [dailyView, weeklyView, analyticsView].forEach(view => view.classList.add('hidden'));
            
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            [dailyTab, weeklyTab, analyticsTab].forEach(tabBtn => {
                tabBtn.classList.remove('active');
                tabBtn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            if (tab === 'daily') {
                dailyView.classList.remove('hidden');
                dailyTab.classList.add('active');
                dailyTab.classList.remove('bg-gray-200', 'text-gray-700');
            } else if (tab === 'weekly') {
                weeklyView.classList.remove('hidden');
                weeklyTab.classList.add('active');
                weeklyTab.classList.remove('bg-gray-200', 'text-gray-700');
            } else if (tab === 'analytics') {
                analyticsView.classList.remove('hidden');
                analyticsTab.classList.add('active');
                analyticsTab.classList.remove('bg-gray-200', 'text-gray-700');
                updateAnalytics();
            }
        }

        function toggleWaterCup(index) {
            const cups = document.querySelectorAll('.water-cup');
            const cup = cups[index];
            
            if (cup.classList.contains('filled')) {
                // ì„ íƒëœ ì»µë¶€í„° ë§ˆì§€ë§‰ê¹Œì§€ ëª¨ë‘ ë¹„ìš°ê¸°
                for (let i = index; i < cups.length; i++) {
                    cups[i].classList.remove('filled');
                }
            } else {
                // ì²« ë²ˆì§¸ë¶€í„° ì„ íƒëœ ì»µê¹Œì§€ ëª¨ë‘ ì±„ìš°ê¸°
                for (let i = 0; i <= index; i++) {
                    cups[i].classList.add('filled');
                }
            }
            
            updateWaterCount();
            saveData();
        }

        function updateWaterCount() {
            const filledCups = document.querySelectorAll('.water-cup.filled').length;
            document.getElementById('waterCount').textContent = filledCups;
            document.getElementById('waterTotal').textContent = filledCups * 500;
        }

        function updateEnergyText(value) {
            const texts = ['ğŸ˜´ í”¼ê³¤', 'ğŸ˜ ë³´í†µ', 'ğŸ˜Š ì¢‹ìŒ', 'ğŸ˜ í™œê¸°', 'ğŸ”¥ ìµœê³ '];
            document.getElementById('energyText').textContent = texts[value - 1];
        }

        function openMealModal(hour) {
            document.getElementById('mealModal').classList.remove('hidden');
            document.getElementById('mealModal').classList.add('flex');
            document.getElementById('mealTime').value = `${hour.toString().padStart(2, '0')}:00`;
        }

        function closeMealModal() {
            document.getElementById('mealModal').classList.add('hidden');
            document.getElementById('mealModal').classList.remove('flex');
        }

        function saveMealTime() {
            const time = document.getElementById('mealTime').value;
            const food = document.getElementById('mealFood').value;
            
            if (time && food) {
                // ì‹œê³„ì— ë§ˆì»¤ ì¶”ê°€ ë¡œì§ (ì„ íƒì‚¬í•­)
                console.log(`${time}ì— ${food} ì„­ì·¨ ê¸°ë¡ë¨`);
            }
            
            closeMealModal();
            saveData();
        }

        function updateCurrentDate() {
            const today = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                weekday: 'long' 
            };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('ko-KR', options);
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ko' ? 'en' : 'ko';
            document.getElementById('langBtn').textContent = currentLanguage === 'ko' ? 'ğŸŒ EN' : 'ğŸŒ í•œêµ­ì–´';
            // ì—¬ê¸°ì— ì‹¤ì œ ì–¸ì–´ ë³€ê²½ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
        }

        function saveData() {
            const data = {
                date: new Date().toDateString(),
                meals: {},
                water: document.querySelectorAll('.water-cup.filled').length,
                weight: document.getElementById('weight').value,
                sleep: document.getElementById('sleep').value,
                energy: document.getElementById('energyLevel').value,
                exercise: document.getElementById('exercise').value,
                dailyNote: document.getElementById('dailyNote').value,
                weeklyNote: document.getElementById('weeklyNote').value,
                weeklyPlan: {}
            };

            // ì‹ì‚¬ ë°ì´í„° ì €ì¥
            document.querySelectorAll('.meal-section').forEach(section => {
                const meal = section.dataset.meal;
                data.meals[meal] = {
                    food: section.querySelector('[data-field="food"]').value,
                    mood: section.querySelector('.mood-icon.selected')?.dataset.mood || null,
                    memo: section.querySelector('[data-field="memo"]').value
                };
            });

            // ì£¼ê°„ ê³„íš ë°ì´í„° ì €ì¥
            document.querySelectorAll('#weeklyTable input').forEach(input => {
                const day = input.dataset.day;
                const meal = input.dataset.meal;
                if (!data.weeklyPlan[day]) data.weeklyPlan[day] = {};
                data.weeklyPlan[day][meal] = input.value;
            });

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            try {
                const dataStr = JSON.stringify(data);
                localStorage.setItem('dietDiary', dataStr);
                console.log('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.log('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¼ë¶€ ë°ì´í„°ë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.');
            }
        }

        function loadData() {
            try {
                const dataStr = localStorage.getItem('dietDiary');
                if (!dataStr) return;
                
                const data = JSON.parse(dataStr);
                
                // ì‹ì‚¬ ë°ì´í„° ë¡œë“œ
                Object.keys(data.meals || {}).forEach(meal => {
                    const section = document.querySelector(`[data-meal="${meal}"]`);
                    if (section) {
                        const mealData = data.meals[meal];
                        section.querySelector('[data-field="food"]').value = mealData.food || '';
                        section.querySelector('[data-field="calories"]').value = mealData.calories || '';
                        section.querySelector('[data-field="memo"]').value = mealData.memo || '';
                        
                        if (mealData.mood) {
                            section.querySelectorAll('.mood-icon').forEach(icon => {
                                icon.classList.remove('selected');
                            });
                            section.querySelector(`[data-mood="${mealData.mood}"]`)?.classList.add('selected');
                        }
                    }
                });

                updateTotalCalories();

                // ë¬¼ ì„­ì·¨ëŸ‰ ë¡œë“œ
                const waterCount = data.water || 0;
                const cups = document.querySelectorAll('.water-cup');
                cups.forEach((cup, index) => {
                    if (index < waterCount) {
                        cup.classList.add('filled');
                    } else {
                        cup.classList.remove('filled');
                    }
                });
                updateWaterCount();

                // ê¸°íƒ€ ë°ì´í„° ë¡œë“œ
                document.getElementById('weight').value = data.weight || '';
                document.getElementById('sleep').value = data.sleep || '';
                document.getElementById('energyLevel').value = data.energy || 3;
                updateEnergyText(data.energy || 3);
                document.getElementById('exercise').value = data.exercise || '';
                document.getElementById('dailyNote').value = data.dailyNote || '';
                document.getElementById('weeklyNote').value = data.weeklyNote || '';

                // ì£¼ê°„ ê³„íš ë°ì´í„° ë¡œë“œ
                Object.keys(data.weeklyPlan || {}).forEach(day => {
                    Object.keys(data.weeklyPlan[day] || {}).forEach(meal => {
                        const input = document.querySelector(`[data-day="${day}"][data-meal="${meal}"]`);
                        if (input) {
                            input.value = data.weeklyPlan[day][meal] || '';
                        }
                    });
                });

            } catch (error) {
                console.log('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function resetData() {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('dietDiary');
                localStorage.removeItem('dietDiaryHistory');
                
                // í¼ ì´ˆê¸°í™”
                document.querySelectorAll('input, textarea').forEach(element => {
                    element.value = '';
                });
                
                // ê¸°ë¶„ ì•„ì´ì½˜ ì´ˆê¸°í™”
                document.querySelectorAll('.mood-icon').forEach(icon => {
                    icon.classList.remove('selected');
                });
                
                // ë¬¼ì»µ ì´ˆê¸°í™”
                document.querySelectorAll('.water-cup').forEach(cup => {
                    cup.classList.remove('filled');
                });
                updateWaterCount();
                
                // ì—ë„ˆì§€ ë ˆë²¨ ì´ˆê¸°í™”
                document.getElementById('energyLevel').value = 3;
                updateEnergyText(3);
                
                // ì´ ì¹¼ë¡œë¦¬ ì´ˆê¸°í™”
                updateTotalCalories();
                
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¶„ì„ ê¸°ê°„ ì „í™˜
        function switchAnalysisPeriod(period) {
            currentAnalysisPeriod = period;
            
            const weeklyBtn = document.getElementById('weeklyAnalysis');
            const monthlyBtn = document.getElementById('monthlyAnalysis');
            
            if (period === 'weekly') {
                weeklyBtn.classList.add('bg-purple-600', 'text-white', 'active');
                weeklyBtn.classList.remove('bg-gray-200', 'text-gray-700');
                monthlyBtn.classList.add('bg-gray-200', 'text-gray-700');
                monthlyBtn.classList.remove('bg-purple-600', 'text-white', 'active');
            } else {
                monthlyBtn.classList.add('bg-purple-600', 'text-white', 'active');
                monthlyBtn.classList.remove('bg-gray-200', 'text-gray-700');
                weeklyBtn.classList.add('bg-gray-200', 'text-gray-700');
                weeklyBtn.classList.remove('bg-purple-600', 'text-white', 'active');
            }
            
            updateAnalytics();
        }

        // ë¶„ì„ ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateAnalytics() {
            const historyData = JSON.parse(localStorage.getItem('dietDiaryHistory') || '[]');
            
            if (historyData.length === 0) {
                showNoDataMessage();
                return;
            }
            
            if (currentAnalysisPeriod === 'weekly') {
                updateWeeklyAnalytics(historyData);
            } else {
                updateMonthlyAnalytics(historyData);
            }
        }

        // ì§€ë‚œ 7ì¼ ë¶„ì„ (ì¼ë³„)
        function updateWeeklyAnalytics(historyData) {
            const last7Days = getLast7DaysData(historyData);
            
            updateCaloriesChart(last7Days, 'daily');
            updateWaterChart(last7Days, 'daily');
            updateWeightChart(last7Days, 'daily');
            updateStatistics(last7Days);
        }

        // ì§€ë‚œ 4ì£¼ ë¶„ì„ (ì£¼ë³„)
        function updateMonthlyAnalytics(historyData) {
            const last4Weeks = getLast4WeeksData(historyData);
            
            updateCaloriesChart(last4Weeks, 'weekly');
            updateWaterChart(last4Weeks, 'weekly');
            updateWeightChart(last4Weeks, 'weekly');
            updateStatistics(last4Weeks);
        }

        // ì§€ë‚œ 7ì¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getLast7DaysData(historyData) {
            const result = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toDateString();
                
                const dayData = historyData.find(entry => entry.date === dateStr);
                result.push({
                    date: date,
                    label: `${date.getMonth() + 1}/${date.getDate()}`,
                    calories: dayData?.totalCalories || 0,
                    water: dayData ? (dayData.water * 500) : 0,
                    weight: dayData?.weight ? parseFloat(dayData.weight) : null
                });
            }
            
            return result;
        }

        // ì§€ë‚œ 4ì£¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì£¼ë³„ í‰ê· )
        function getLast4WeeksData(historyData) {
            const result = [];
            const today = new Date();
            
            for (let week = 3; week >= 0; week--) {
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - (week * 7 + 6));
                const weekEnd = new Date(today);
                weekEnd.setDate(today.getDate() - (week * 7));
                
                const weekData = historyData.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate >= weekStart && entryDate <= weekEnd;
                });
                
                const avgCalories = weekData.length > 0 ? 
                    Math.round(weekData.reduce((sum, day) => sum + (day.totalCalories || 0), 0) / weekData.length) : 0;
                
                const avgWater = weekData.length > 0 ? 
                    Math.round(weekData.reduce((sum, day) => sum + ((day.water || 0) * 500), 0) / weekData.length) : 0;
                
                const weights = weekData.map(day => day.weight ? parseFloat(day.weight) : null).filter(w => w !== null);
                const avgWeight = weights.length > 0 ? 
                    Math.round((weights.reduce((sum, w) => sum + w, 0) / weights.length) * 10) / 10 : null;
                
                result.push({
                    label: `${weekStart.getMonth() + 1}/${weekStart.getDate()} ì£¼`,
                    calories: avgCalories,
                    water: avgWater,
                    weight: avgWeight
                });
            }
            
            return result;
        }

        // ì¹¼ë¡œë¦¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCaloriesChart(data, type) {
            const ctx = document.getElementById('caloriesChart').getContext('2d');
            
            if (caloriesChart) {
                caloriesChart.destroy();
            }
            
            caloriesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.label),
                    datasets: [{
                        label: type === 'daily' ? 'ì¼ì¼ ì¹¼ë¡œë¦¬' : 'ì£¼ê°„ í‰ê·  ì¹¼ë¡œë¦¬',
                        data: data.map(d => d.calories),
                        borderColor: '#e879f9',
                        backgroundColor: 'rgba(232, 121, 249, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'kcal'
                            }
                        }
                    }
                }
            });
        }

        // ìˆ˜ë¶„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateWaterChart(data, type) {
            const ctx = document.getElementById('waterChart').getContext('2d');
            
            if (waterChart) {
                waterChart.destroy();
            }
            
            waterChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.label),
                    datasets: [{
                        label: type === 'daily' ? 'ì¼ì¼ ìˆ˜ë¶„ ì„­ì·¨' : 'ì£¼ê°„ í‰ê·  ìˆ˜ë¶„ ì„­ì·¨',
                        data: data.map(d => d.water),
                        backgroundColor: 'rgba(6, 182, 212, 0.8)',
                        borderColor: '#06b6d4',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 2500,
                            title: {
                                display: true,
                                text: 'ml'
                            }
                        }
                    }
                }
            });
        }

        // ì²´ì¤‘ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateWeightChart(data, type) {
            const ctx = document.getElementById('weightChart').getContext('2d');
            
            if (weightChart) {
                weightChart.destroy();
            }
            
            const weightData = data.filter(d => d.weight !== null);
            
            if (weightData.length === 0) {
                ctx.fillText('ì²´ì¤‘ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 50, 50);
                return;
            }
            
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weightData.map(d => d.label),
                    datasets: [{
                        label: type === 'daily' ? 'ì¼ì¼ ì²´ì¤‘' : 'ì£¼ê°„ í‰ê·  ì²´ì¤‘',
                        data: weightData.map(d => d.weight),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'kg'
                            }
                        }
                    }
                }
            });
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics(data) {
            const calories = data.map(d => d.calories).filter(c => c > 0);
            const water = data.map(d => d.water).filter(w => w > 0);
            
            // ì¹¼ë¡œë¦¬ í†µê³„
            const avgCalories = calories.length > 0 ? Math.round(calories.reduce((a, b) => a + b, 0) / calories.length) : 0;
            const maxCalories = calories.length > 0 ? Math.max(...calories) : 0;
            const minCalories = calories.length > 0 ? Math.min(...calories) : 0;
            
            document.getElementById('avgCalories').textContent = avgCalories + ' kcal';
            document.getElementById('maxCalories').textContent = maxCalories + ' kcal';
            document.getElementById('minCalories').textContent = minCalories + ' kcal';
            
            // ìˆ˜ë¶„ í†µê³„
            const avgWater = water.length > 0 ? Math.round(water.reduce((a, b) => a + b, 0) / water.length) : 0;
            const goalRate = Math.round((avgWater / 2000) * 100);
            
            document.getElementById('avgWater').textContent = avgWater + ' ml';
            document.getElementById('waterGoalRate').textContent = Math.min(goalRate, 100) + '%';
            document.getElementById('waterProgress').style.width = Math.min(goalRate, 100) + '%';
            
            // ì²´ì¤‘ ë³€í™”
            const weights = data.map(d => d.weight).filter(w => w !== null);
            if (weights.length >= 2) {
                const weightChange = Math.round((weights[weights.length - 1] - weights[0]) * 10) / 10;
                const changeText = weightChange > 0 ? `+${weightChange} kg` : `${weightChange} kg`;
                document.getElementById('weightChange').textContent = changeText;
            } else {
                document.getElementById('weightChange').textContent = 'ë°ì´í„° ë¶€ì¡±';
            }
            
            // ì¢…í•© ì ìˆ˜ ê³„ì‚°
            updateHealthScores(data);
        }

        // ê±´ê°• ì ìˆ˜ ê³„ì‚°
        function updateHealthScores(data) {
            const validDays = data.filter(d => d.calories > 0 || d.water > 0);
            
            // ìˆ˜ë¶„ ì ìˆ˜ (ëª©í‘œ 2000ml ê¸°ì¤€)
            const waterScores = data.map(d => Math.min((d.water / 2000) * 100, 100));
            const hydrationScore = waterScores.length > 0 ? Math.round(waterScores.reduce((a, b) => a + b, 0) / waterScores.length) : 0;
            
            // ê¾¸ì¤€í•¨ ì ìˆ˜ (ê¸°ë¡í•œ ë‚  ë¹„ìœ¨)
            const consistencyScore = Math.round((validDays.length / data.length) * 100);
            
            // ê· í˜• ì ìˆ˜ (ì¹¼ë¡œë¦¬ í‘œì¤€í¸ì°¨ ê¸°ë°˜)
            const calories = data.map(d => d.calories).filter(c => c > 0);
            let balanceScore = 80; // ê¸°ë³¸ê°’
            if (calories.length > 2) {
                const avg = calories.reduce((a, b) => a + b, 0) / calories.length;
                const variance = calories.reduce((sum, cal) => sum + Math.pow(cal - avg, 2), 0) / calories.length;
                const stdDev = Math.sqrt(variance);
                balanceScore = Math.max(0, Math.min(100, 100 - (stdDev / avg) * 100));
            }
            
            // ì¢…í•© ì ìˆ˜
            const overallScore = Math.round((hydrationScore + consistencyScore + balanceScore) / 3);
            
            document.getElementById('overallScore').textContent = overallScore;
            document.getElementById('hydrationScore').textContent = hydrationScore;
            document.getElementById('consistencyScore').textContent = consistencyScore;
            document.getElementById('balanceScore').textContent = Math.round(balanceScore);
        }

        // ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€
        function showNoDataMessage() {
            ['caloriesChart', 'waterChart', 'weightChart'].forEach(chartId => {
                const canvas = document.getElementById(chartId);
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#6b7280';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', canvas.width / 2, canvas.height / 2);
                ctx.fillText('ë©°ì¹  ë” ê¸°ë¡í•´ë³´ì„¸ìš”! ğŸ’ª', canvas.width / 2, canvas.height / 2 + 25);
            });
            
            // í†µê³„ ì´ˆê¸°í™”
            document.getElementById('avgCalories').textContent = '0 kcal';
            document.getElementById('maxCalories').textContent = '0 kcal';
            document.getElementById('minCalories').textContent = '0 kcal';
            document.getElementById('avgWater').textContent = '0 ml';
            document.getElementById('waterGoalRate').textContent = '0%';
            document.getElementById('weightChange').textContent = 'ë°ì´í„° ì—†ìŒ';
        }
        function exportData() {
            try {
                const dataStr = localStorage.getItem('dietDiary');
                if (!dataStr) {
                    alert('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const data = JSON.parse(dataStr);
                const exportData = {
                    ...data,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                    type: 'application/json' 
                });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `diet-diary-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('ë°ì´í„°ê°€ ë‹¤ìš´ë¡œë“œ í´ë”ì— ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³µì›)
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // ë°±ì—… íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
                    if (!importedData.meals && !importedData.weeklyPlan) {
                        alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°±ì—… íŒŒì¼ì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    // ê¸°ì¡´ ë°ì´í„° ë®ì–´ì“°ê¸° í™•ì¸
                    if (localStorage.getItem('dietDiary')) {
                        if (!confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            return;
                        }
                    }
                    
                    localStorage.setItem('dietDiary', JSON.stringify(importedData));
                    loadData();
                    alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                } catch (error) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (ì„ íƒì‚¬í•­)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        saveData();
                        break;
                    case '1':
                        e.preventDefault();
                        switchTab('daily');
                        break;
                    case '2':
                        e.preventDefault();
                        switchTab('weekly');
                        break;
                }
            }
        });

        // PWA ì§€ì›ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (ì„ íƒì‚¬í•­)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ íŒŒì¼ì„ ë§Œë“¤ì–´ ë“±ë¡
                console.log('PWA ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ êµ¬í˜„í•˜ì„¸ìš”.');
            });
        }

        // í„°ì¹˜ ì œìŠ¤ì²˜ ì§€ì› (ëª¨ë°”ì¼)
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ì£¼ê°„ ê³„íšìœ¼ë¡œ
                    switchTab('weekly');
                } else {
                    // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ë°ì¼ë¦¬ë¡œ
                    switchTab('daily');
                }
            }
        }

        // ë°˜ì‘í˜• ë””ìì¸ì„ ìœ„í•œ í™”ë©´ í¬ê¸° ê°ì§€
        function handleResize() {
            const isMobile = window.innerWidth < 768;
            
            if (isMobile) {
                // ëª¨ë°”ì¼ì—ì„œëŠ” í…Œì´ë¸”ì„ ì¹´ë“œ í˜•íƒœë¡œ ë³€ê²½ (ì„ íƒì‚¬í•­)
                document.querySelectorAll('.glass-card').forEach(card => {
                    card.style.margin = '0.5rem 0';
                });
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // ì´ˆê¸° ì‹¤í–‰

        // ë‹¤í¬ ëª¨ë“œ í† ê¸€ (ì„ íƒì‚¬í•­)
        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            localStorage.setItem('darkMode', isDark);
        }

        // ë‹¤í¬ ëª¨ë“œ ì„¤ì • ë¡œë“œ
        function loadDarkMode() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark');
            }
        }

        // ì•Œë¦¼ ë° ë¦¬ë§ˆì¸ë” ê¸°ëŠ¥ (ì„ íƒì‚¬í•­)
        function setReminder() {
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    if (permission === 'granted') {
                        // ì‹ì‚¬ ì‹œê°„ ì•Œë¦¼ ì„¤ì •
                        const now = new Date();
                        const nextMealTime = new Date(now);
                        nextMealTime.setHours(12, 0, 0, 0); // ì ì‹¬ ì‹œê°„ ì˜ˆì‹œ
                        
                        if (nextMealTime > now) {
                            const timeUntilMeal = nextMealTime.getTime() - now.getTime();
                            setTimeout(function() {
                                new Notification('ğŸ½ï¸ ì‹ì‚¬ ì‹œê°„ì´ì—ìš”!', {
                                    body: 'ì˜¤ëŠ˜ì˜ ì‹ì‚¬ë¥¼ ê¸°ë¡í•´ë³´ì„¸ìš”.',
                                    icon: '/icon-192x192.png' // ì‹¤ì œ ì•„ì´ì½˜ ê²½ë¡œ
                                });
                            }, timeUntilMeal);
                        }
                    }
                });
            }
        }

        // ì•± ì´ˆê¸°í™” ì‹œ ì•Œë¦¼ ì„¤ì •
        // setReminder(); // í•„ìš”ì‹œ ì£¼ì„ í•´ì œ
    </script>
</body>
</html>
