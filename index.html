<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤ì´ì–´íŠ¸ ë‹¤ì´ì–´ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f5f3ff 0%, #fef7f0 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .clock-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        
        .clock-face {
            width: 100%;
            height: 100%;
            border: 3px solid #e879f9;
            border-radius: 50%;
            position: relative;
            background: white;
        }
        
        .clock-number {
            position: absolute;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #6b21a8;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .clock-number:hover {
            background: #f3e8ff;
            transform: scale(1.1);
        }
        
        .clock-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: #e879f9;
            border-radius: 50%;
        }
        
        .water-cup {
            width: 40px;
            height: 50px;
            border: 2px solid #06b6d4;
            border-radius: 0 0 8px 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .water-cup.filled {
            background: linear-gradient(to top, #06b6d4 0%, #67e8f9 100%);
        }
        
        .mood-icon {
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .mood-icon:hover {
            background: #f3e8ff;
            transform: scale(1.1);
        }
        
        .mood-icon.selected {
            background: #e879f9;
            color: white;
        }
        
        .energy-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e5e7eb;
            outline: none;
        }
        
        .energy-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e879f9;
            cursor: pointer;
        }
        
        .tab-button {
            transition: all 0.3s;
        }
        
        .tab-button.active {
            background: #e879f9;
            color: white;
        }
        
        .meal-time-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <!-- í—¤ë” -->
        <div class="glass-card rounded-lg p-6 mb-6 shadow-lg">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold text-purple-800">ğŸ’œ ë‹¤ì´ì–´íŠ¸ ë‹¤ì´ì–´ë¦¬</h1>
                <div class="flex gap-4">
                    <button id="exportBtn" class="px-4 py-2 bg-green-200 text-green-800 rounded-lg hover:bg-green-300 transition-all">
                        ğŸ’¾ ë°±ì—…
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                    <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 bg-blue-200 text-blue-800 rounded-lg hover:bg-blue-300 transition-all">
                        ğŸ“ ë³µì›
                    </button>
                    <button id="langBtn" class="px-4 py-2 bg-purple-200 text-purple-800 rounded-lg hover:bg-purple-300 transition-all">
                        ğŸŒ EN
                    </button>
                    <button id="resetBtn" class="px-4 py-2 bg-red-200 text-red-800 rounded-lg hover:bg-red-300 transition-all">
                        ğŸ”„ ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="glass-card rounded-lg p-4 mb-6 shadow-lg">
            <div class="flex gap-4">
                <button id="dailyTab" class="tab-button px-6 py-3 rounded-lg font-semibold active">
                    ğŸ“† ì˜¤ëŠ˜ì˜ ë‹¤ì§
                </button>
                <button id="weeklyTab" class="tab-button px-6 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700">
                    ğŸ“… 7ì¼ ì‹ë‹¨ ê³„íš
                </button>
            </div>
        </div>

        <!-- ë°ì¼ë¦¬ í™”ë©´ -->
        <div id="dailyView" class="space-y-6">
            <!-- ë‚ ì§œ í‘œì‹œ -->
            <div class="glass-card rounded-lg p-4 shadow-lg">
                <h2 class="text-xl font-bold text-purple-800 mb-2" id="currentDate"></h2>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- 24ì‹œê°„ ì›í˜• ì‹œê³„ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ• ì‹ì‚¬ ì‹œê°„ ê¸°ë¡</h3>
                    <div class="clock-container">
                        <div class="clock-face" id="clockFace">
                            <div class="clock-center"></div>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <p class="text-sm text-gray-600">ì‹œê°„ì„ í´ë¦­í•˜ì—¬ ì‹ì‚¬ ê¸°ë¡</p>
                    </div>
                </div>

                <!-- ë¬¼ ì„­ì·¨ëŸ‰ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ’§ ë¬¼ ì„­ì·¨ëŸ‰</h3>
                    <div class="grid grid-cols-4 gap-4 mb-4" id="waterCups">
                        <!-- ë¬¼ì»µë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="text-center">
                        <span class="text-lg font-bold text-blue-600" id="waterCount">0</span> / 8 ì»µ
                        <p class="text-sm text-gray-600">(ì´ <span id="waterTotal">0</span>ml)</p>
                    </div>
                </div>
            </div>

            <!-- ì‹ì‚¬ë³„ ê¸°ë¡ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ½ï¸ ì‹ì‚¬ ê¸°ë¡</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="meal-section" data-meal="breakfast">
                        <h4 class="font-semibold text-purple-700 mb-3">ğŸŒ… ì•„ì¹¨</h4>
                        <input type="text" placeholder="ìŒì‹ ì…ë ¥" class="w-full p-2 border rounded-lg mb-2" data-field="food">
                        <div class="flex gap-1 mb-2" data-field="mood">
                            <span class="mood-icon" data-mood="1">ğŸ˜£</span>
                            <span class="mood-icon" data-mood="2">ğŸ˜</span>
                            <span class="mood-icon" data-mood="3">ğŸ™‚</span>
                            <span class="mood-icon" data-mood="4">ğŸ˜‹</span>
                        </div>
                        <textarea placeholder="ë©”ëª¨" class="w-full p-2 border rounded-lg text-sm" rows="2" data-field="memo"></textarea>
                    </div>
                    
                    <div class="meal-section" data-meal="lunch">
                        <h4 class="font-semibold text-purple-700 mb-3">â˜€ï¸ ì ì‹¬</h4>
                        <input type="text" placeholder="ìŒì‹ ì…ë ¥" class="w-full p-2 border rounded-lg mb-2" data-field="food">
                        <div class="flex gap-1 mb-2" data-field="mood">
                            <span class="mood-icon" data-mood="1">ğŸ˜£</span>
                            <span class="mood-icon" data-mood="2">ğŸ˜</span>
                            <span class="mood-icon" data-mood="3">ğŸ™‚</span>
                            <span class="mood-icon" data-mood="4">ğŸ˜‹</span>
                        </div>
                        <textarea placeholder="ë©”ëª¨" class="w-full p-2 border rounded-lg text-sm" rows="2" data-field="memo"></textarea>
                    </div>
                    
                    <div class="meal-section" data-meal="snack">
                        <h4 class="font-semibold text-purple-700 mb-3">ğŸª ê°„ì‹</h4>
                        <input type="text" placeholder="ìŒì‹ ì…ë ¥" class="w-full p-2 border rounded-lg mb-2" data-field="food">
                        <div class="flex gap-1 mb-2" data-field="mood">
                            <span class="mood-icon" data-mood="1">ğŸ˜£</span>
                            <span class="mood-icon" data-mood="2">ğŸ˜</span>
                            <span class="mood-icon" data-mood="3">ğŸ™‚</span>
                            <span class="mood-icon" data-mood="4">ğŸ˜‹</span>
                        </div>
                        <textarea placeholder="ë©”ëª¨" class="w-full p-2 border rounded-lg text-sm" rows="2" data-field="memo"></textarea>
                    </div>
                    
                    <div class="meal-section" data-meal="dinner">
                        <h4 class="font-semibold text-purple-700 mb-3">ğŸŒ™ ì €ë…</h4>
                        <input type="text" placeholder="ìŒì‹ ì…ë ¥" class="w-full p-2 border rounded-lg mb-2" data-field="food">
                        <div class="flex gap-1 mb-2" data-field="mood">
                            <span class="mood-icon" data-mood="1">ğŸ˜£</span>
                            <span class="mood-icon" data-mood="2">ğŸ˜</span>
                            <span class="mood-icon" data-mood="3">ğŸ™‚</span>
                            <span class="mood-icon" data-mood="4">ğŸ˜‹</span>
                        </div>
                        <textarea placeholder="ë©”ëª¨" class="w-full p-2 border rounded-lg text-sm" rows="2" data-field="memo"></textarea>
                    </div>
                </div>
            </div>

            <!-- ê¸°íƒ€ ê¸°ë¡ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- ì²´ì¤‘ & ìˆ˜ë©´ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">âš–ï¸ ì²´ì¤‘ & ìˆ˜ë©´</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ì²´ì¤‘ (kg)</label>
                            <input type="number" step="0.1" placeholder="60.0" class="w-full p-2 border rounded-lg" id="weight">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ìˆ˜ë©´ ì‹œê°„</label>
                            <input type="number" step="0.5" placeholder="8.0" class="w-full p-2 border rounded-lg" id="sleep">
                        </div>
                    </div>
                </div>

                <!-- ì—ë„ˆì§€ ë ˆë²¨ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">âš¡ ì—ë„ˆì§€ ë ˆë²¨</h3>
                    <div class="space-y-4">
                        <input type="range" min="1" max="5" value="3" class="energy-slider" id="energyLevel">
                        <div class="flex justify-between text-xs text-gray-600">
                            <span>ğŸ˜´ í”¼ê³¤</span>
                            <span>ğŸ˜ ë³´í†µ</span>
                            <span>ğŸ˜Š ì¢‹ìŒ</span>
                            <span>ğŸ˜ í™œê¸°</span>
                            <span>ğŸ”¥ ìµœê³ </span>
                        </div>
                        <div class="text-center">
                            <span class="text-lg font-bold text-purple-600" id="energyText">ê¸°ë¶„ ì¢‹ìŒ</span>
                        </div>
                    </div>
                </div>

                <!-- ìš´ë™ ê¸°ë¡ -->
                <div class="glass-card rounded-lg p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸƒâ€â™€ï¸ ìš´ë™ ê¸°ë¡</h3>
                    <textarea placeholder="ì˜¤ëŠ˜ í•œ ìš´ë™ì„ ê¸°ë¡í•´ë³´ì„¸ìš”" class="w-full p-2 border rounded-lg" rows="4" id="exercise"></textarea>
                </div>
            </div>

            <!-- ì˜¤ëŠ˜ì˜ ë…¸íŠ¸ -->
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ“ ì˜¤ëŠ˜ì˜ ë…¸íŠ¸</h3>
                <textarea placeholder="ì˜¤ëŠ˜ì˜ ì†Œê°ì´ë‚˜ ë‹¤ì§ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”" class="w-full p-3 border rounded-lg" rows="4" id="dailyNote"></textarea>
            </div>
        </div>

        <!-- ì£¼ê°„ ê³„íš í™”ë©´ -->
        <div id="weeklyView" class="hidden">
            <div class="glass-card rounded-lg p-6 shadow-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-4">ğŸ“… 7ì¼ ì‹ë‹¨ ê³„íš</h3>
                
                <!-- ì£¼ê°„ í…Œì´ë¸” -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-purple-100">
                                <th class="border border-purple-200 p-3 text-purple-800">ë‚ ì§œ</th>
                                <th class="border border-purple-200 p-3 text-purple-800">ğŸŒ… ì•„ì¹¨</th>
                                <th class="border border-purple-200 p-3 text-purple-800">â˜€ï¸ ì ì‹¬</th>
                                <th class="border border-purple-200 p-3 text-purple-800">ğŸª ê°„ì‹</th>
                                <th class="border border-purple-200 p-3 text-purple-800">ğŸŒ™ ì €ë…</th>
                            </tr>
                        </thead>
                        <tbody id="weeklyTable">
                            <!-- í…Œì´ë¸” í–‰ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>

                <!-- ì£¼ê°„ ë©”ëª¨ -->
                <div class="mt-6">
                    <h4 class="text-md font-semibold text-purple-700 mb-2">ğŸ“‹ ì£¼ê°„ ë©”ëª¨</h4>
                    <textarea placeholder="ì´ë²ˆ ì£¼ ì‹ë‹¨ ê³„íšì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”" class="w-full p-3 border rounded-lg" rows="4" id="weeklyNote"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‹ì‚¬ ì‹œê°„ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="mealModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="glass-card rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold text-purple-800 mb-4" id="modalTitle">ì‹ì‚¬ ê¸°ë¡</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì‹œê°„</label>
                    <input type="time" class="w-full p-2 border rounded-lg" id="mealTime">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ìŒì‹</label>
                    <input type="text" placeholder="ë¨¹ì€ ìŒì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" class="w-full p-2 border rounded-lg" id="mealFood">
                </div>
                <div class="flex gap-4">
                    <button id="saveMeal" class="flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">ì €ì¥</button>
                    <button id="cancelMeal" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentLanguage = 'ko';
        let mealTimes = [];
        
        // ì–¸ì–´ ë°ì´í„°
        const translations = {
            ko: {
                title: "ğŸ’œ ë‹¤ì´ì–´íŠ¸ ë‹¤ì´ì–´ë¦¬",
                dailyTab: "ğŸ“† ì˜¤ëŠ˜ì˜ ë‹¤ì§",
                weeklyTab: "ğŸ“… 7ì¼ ì‹ë‹¨ ê³„íš",
                clockTitle: "ğŸ• ì‹ì‚¬ ì‹œê°„ ê¸°ë¡",
                waterTitle: "ğŸ’§ ë¬¼ ì„­ì·¨ëŸ‰",
                mealTitle: "ğŸ½ï¸ ì‹ì‚¬ ê¸°ë¡",
                breakfast: "ğŸŒ… ì•„ì¹¨",
                lunch: "â˜€ï¸ ì ì‹¬",
                snack: "ğŸª ê°„ì‹",
                dinner: "ğŸŒ™ ì €ë…",
                weightSleep: "âš–ï¸ ì²´ì¤‘ & ìˆ˜ë©´",
                energy: "âš¡ ì—ë„ˆì§€ ë ˆë²¨",
                exercise: "ğŸƒâ€â™€ï¸ ìš´ë™ ê¸°ë¡",
                dailyNote: "ğŸ“ ì˜¤ëŠ˜ì˜ ë…¸íŠ¸"
            },
            en: {
                title: "ğŸ’œ Diet Diary",
                dailyTab: "ğŸ“† Today's Goal",
                weeklyTab: "ğŸ“… 7-Day Meal Plan",
                clockTitle: "ğŸ• Meal Time Record",
                waterTitle: "ğŸ’§ Water Intake",
                mealTitle: "ğŸ½ï¸ Meal Record",
                breakfast: "ğŸŒ… Breakfast",
                lunch: "â˜€ï¸ Lunch",
                snack: "ğŸª Snack",
                dinner: "ğŸŒ™ Dinner",
                weightSleep: "âš–ï¸ Weight & Sleep",
                energy: "âš¡ Energy Level",
                exercise: "ğŸƒâ€â™€ï¸ Exercise Record",
                dailyNote: "ğŸ“ Daily Note"
            }
        };

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            setupClock();
            setupWaterCups();
            setupWeeklyTable();
            setupEventListeners();
            loadDarkMode();
            loadData();
            updateCurrentDate();
        }

        function setupClock() {
            const clockFace = document.getElementById('clockFace');
            const radius = 85; // ì‹œê³„ ë°˜ì§€ë¦„
            const centerX = 100;
            const centerY = 100;

            for (let i = 1; i <= 24; i++) {
                const angle = (i * 15 - 90) * (Math.PI / 180); // 12ì‹œë¶€í„° ì‹œì‘
                const x = centerX + radius * Math.cos(angle) - 15;
                const y = centerY + radius * Math.sin(angle) - 15;

                const hourElement = document.createElement('div');
                hourElement.className = 'clock-number';
                hourElement.style.left = x + 'px';
                hourElement.style.top = y + 'px';
                hourElement.textContent = i;
                hourElement.addEventListener('click', () => openMealModal(i));

                clockFace.appendChild(hourElement);
            }
        }

        function setupWaterCups() {
            const waterCups = document.getElementById('waterCups');
            for (let i = 0; i < 8; i++) {
                const cup = document.createElement('div');
                cup.className = 'water-cup';
                cup.addEventListener('click', () => toggleWaterCup(i));
                waterCups.appendChild(cup);
            }
        }

        function setupWeeklyTable() {
            const tbody = document.getElementById('weeklyTable');
            const today = new Date();
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-purple-200 p-2 font-medium text-purple-700">
                        ${date.getMonth() + 1}/${date.getDate()} (${['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()]})
                    </td>
                    <td class="border border-purple-200 p-2">
                        <input type="text" class="w-full p-1 border-0 bg-transparent" data-day="${i}" data-meal="breakfast">
                    </td>
                    <td class="border border-purple-200 p-2">
                        <input type="text" class="w-full p-1 border-0 bg-transparent" data-day="${i}" data-meal="lunch">
                    </td>
                    <td class="border border-purple-200 p-2">
                        <input type="text" class="w-full p-1 border-0 bg-transparent" data-day="${i}" data-meal="snack">
                    </td>
                    <td class="border border-purple-200 p-2">
                        <input type="text" class="w-full p-1 border-0 bg-transparent" data-day="${i}" data-meal="dinner">
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function setupEventListeners() {
            // íƒ­ ì „í™˜
            document.getElementById('dailyTab').addEventListener('click', () => switchTab('daily'));
            document.getElementById('weeklyTab').addEventListener('click', () => switchTab('weekly'));
            
            // ë°±ì—…/ë³µì› ë²„íŠ¼
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importFile').addEventListener('change', importData);
            
            // ì–¸ì–´ ì „í™˜
            document.getElementById('langBtn').addEventListener('click', toggleLanguage);
            
            // ì´ˆê¸°í™” ë²„íŠ¼
            document.getElementById('resetBtn').addEventListener('click', resetData);
            
            // ê¸°ë¶„ ì•„ì´ì½˜ í´ë¦­
            document.querySelectorAll('.mood-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const parent = this.parentElement;
                    parent.querySelectorAll('.mood-icon').forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    saveData();
                });
            });
            
            // ì—ë„ˆì§€ ìŠ¬ë¼ì´ë”
            document.getElementById('energyLevel').addEventListener('input', function() {
                updateEnergyText(this.value);
                saveData();
            });
            
            // ëª¨ë“  ì…ë ¥ í•„ë“œì— ìë™ ì €ì¥
            document.querySelectorAll('input, textarea').forEach(element => {
                element.addEventListener('input', saveData);
            });
            
            // ëª¨ë‹¬ ì´ë²¤íŠ¸
            document.getElementById('saveMeal').addEventListener('click', saveMealTime);
            document.getElementById('cancelMeal').addEventListener('click', closeMealModal);
        }

        function switchTab(tab) {
            const dailyView = document.getElementById('dailyView');
            const weeklyView = document.getElementById('weeklyView');
            const dailyTab = document.getElementById('dailyTab');
            const weeklyTab = document.getElementById('weeklyTab');
            
            if (tab === 'daily') {
                dailyView.classList.remove('hidden');
                weeklyView.classList.add('hidden');
                dailyTab.classList.add('active');
                weeklyTab.classList.remove('active');
                dailyTab.classList.remove('bg-gray-200', 'text-gray-700');
                weeklyTab.classList.add('bg-gray-200', 'text-gray-700');
            } else {
                dailyView.classList.add('hidden');
                weeklyView.classList.remove('hidden');
                weeklyTab.classList.add('active');
                dailyTab.classList.remove('active');
                weeklyTab.classList.remove('bg-gray-200', 'text-gray-700');
                dailyTab.classList.add('bg-gray-200', 'text-gray-700');
            }
        }

        function toggleWaterCup(index) {
            const cups = document.querySelectorAll('.water-cup');
            const cup = cups[index];
            
            if (cup.classList.contains('filled')) {
                // ì„ íƒëœ ì»µë¶€í„° ë§ˆì§€ë§‰ê¹Œì§€ ëª¨ë‘ ë¹„ìš°ê¸°
                for (let i = index; i < cups.length; i++) {
                    cups[i].classList.remove('filled');
                }
            } else {
                // ì²« ë²ˆì§¸ë¶€í„° ì„ íƒëœ ì»µê¹Œì§€ ëª¨ë‘ ì±„ìš°ê¸°
                for (let i = 0; i <= index; i++) {
                    cups[i].classList.add('filled');
                }
            }
            
            updateWaterCount();
            saveData();
        }

        function updateWaterCount() {
            const filledCups = document.querySelectorAll('.water-cup.filled').length;
            document.getElementById('waterCount').textContent = filledCups;
            document.getElementById('waterTotal').textContent = filledCups * 500;
        }

        function updateEnergyText(value) {
            const texts = ['ğŸ˜´ í”¼ê³¤', 'ğŸ˜ ë³´í†µ', 'ğŸ˜Š ì¢‹ìŒ', 'ğŸ˜ í™œê¸°', 'ğŸ”¥ ìµœê³ '];
            document.getElementById('energyText').textContent = texts[value - 1];
        }

        function openMealModal(hour) {
            document.getElementById('mealModal').classList.remove('hidden');
            document.getElementById('mealModal').classList.add('flex');
            document.getElementById('mealTime').value = `${hour.toString().padStart(2, '0')}:00`;
        }

        function closeMealModal() {
            document.getElementById('mealModal').classList.add('hidden');
            document.getElementById('mealModal').classList.remove('flex');
        }

        function saveMealTime() {
            const time = document.getElementById('mealTime').value;
            const food = document.getElementById('mealFood').value;
            
            if (time && food) {
                // ì‹œê³„ì— ë§ˆì»¤ ì¶”ê°€ ë¡œì§ (ì„ íƒì‚¬í•­)
                console.log(`${time}ì— ${food} ì„­ì·¨ ê¸°ë¡ë¨`);
            }
            
            closeMealModal();
            saveData();
        }

        function updateCurrentDate() {
            const today = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                weekday: 'long' 
            };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('ko-KR', options);
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ko' ? 'en' : 'ko';
            document.getElementById('langBtn').textContent = currentLanguage === 'ko' ? 'ğŸŒ EN' : 'ğŸŒ í•œêµ­ì–´';
            // ì—¬ê¸°ì— ì‹¤ì œ ì–¸ì–´ ë³€ê²½ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
        }

        function saveData() {
            const data = {
                date: new Date().toDateString(),
                meals: {},
                water: document.querySelectorAll('.water-cup.filled').length,
                weight: document.getElementById('weight').value,
                sleep: document.getElementById('sleep').value,
                energy: document.getElementById('energyLevel').value,
                exercise: document.getElementById('exercise').value,
                dailyNote: document.getElementById('dailyNote').value,
                weeklyNote: document.getElementById('weeklyNote').value,
                weeklyPlan: {}
            };

            // ì‹ì‚¬ ë°ì´í„° ì €ì¥
            document.querySelectorAll('.meal-section').forEach(section => {
                const meal = section.dataset.meal;
                data.meals[meal] = {
                    food: section.querySelector('[data-field="food"]').value,
                    mood: section.querySelector('.mood-icon.selected')?.dataset.mood || null,
                    memo: section.querySelector('[data-field="memo"]').value
                };
            });

            // ì£¼ê°„ ê³„íš ë°ì´í„° ì €ì¥
            document.querySelectorAll('#weeklyTable input').forEach(input => {
                const day = input.dataset.day;
                const meal = input.dataset.meal;
                if (!data.weeklyPlan[day]) data.weeklyPlan[day] = {};
                data.weeklyPlan[day][meal] = input.value;
            });

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            try {
                const dataStr = JSON.stringify(data);
                localStorage.setItem('dietDiary', dataStr);
                console.log('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.log('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¼ë¶€ ë°ì´í„°ë¥¼ ì‚­ì œí•´ì£¼ì„¸ìš”.');
            }
        }

        function loadData() {
            try {
                const dataStr = localStorage.getItem('dietDiary');
                if (!dataStr) return;
                
                const data = JSON.parse(dataStr);
                
                // ì‹ì‚¬ ë°ì´í„° ë¡œë“œ
                Object.keys(data.meals || {}).forEach(meal => {
                    const section = document.querySelector(`[data-meal="${meal}"]`);
                    if (section) {
                        const mealData = data.meals[meal];
                        section.querySelector('[data-field="food"]').value = mealData.food || '';
                        section.querySelector('[data-field="memo"]').value = mealData.memo || '';
                        
                        if (mealData.mood) {
                            section.querySelectorAll('.mood-icon').forEach(icon => {
                                icon.classList.remove('selected');
                            });
                            section.querySelector(`[data-mood="${mealData.mood}"]`)?.classList.add('selected');
                        }
                    }
                });

                // ë¬¼ ì„­ì·¨ëŸ‰ ë¡œë“œ
                const waterCount = data.water || 0;
                const cups = document.querySelectorAll('.water-cup');
                cups.forEach((cup, index) => {
                    if (index < waterCount) {
                        cup.classList.add('filled');
                    } else {
                        cup.classList.remove('filled');
                    }
                });
                updateWaterCount();

                // ê¸°íƒ€ ë°ì´í„° ë¡œë“œ
                document.getElementById('weight').value = data.weight || '';
                document.getElementById('sleep').value = data.sleep || '';
                document.getElementById('energyLevel').value = data.energy || 3;
                updateEnergyText(data.energy || 3);
                document.getElementById('exercise').value = data.exercise || '';
                document.getElementById('dailyNote').value = data.dailyNote || '';
                document.getElementById('weeklyNote').value = data.weeklyNote || '';

                // ì£¼ê°„ ê³„íš ë°ì´í„° ë¡œë“œ
                Object.keys(data.weeklyPlan || {}).forEach(day => {
                    Object.keys(data.weeklyPlan[day] || {}).forEach(meal => {
                        const input = document.querySelector(`[data-day="${day}"][data-meal="${meal}"]`);
                        if (input) {
                            input.value = data.weeklyPlan[day][meal] || '';
                        }
                    });
                });

            } catch (error) {
                console.log('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function resetData() {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('dietDiary');
                
                // í¼ ì´ˆê¸°í™”
                document.querySelectorAll('input, textarea').forEach(element => {
                    element.value = '';
                });
                
                // ê¸°ë¶„ ì•„ì´ì½˜ ì´ˆê¸°í™”
                document.querySelectorAll('.mood-icon').forEach(icon => {
                    icon.classList.remove('selected');
                });
                
                // ë¬¼ì»µ ì´ˆê¸°í™”
                document.querySelectorAll('.water-cup').forEach(cup => {
                    cup.classList.remove('filled');
                });
                updateWaterCount();
                
                // ì—ë„ˆì§€ ë ˆë²¨ ì´ˆê¸°í™”
                document.getElementById('energyLevel').value = 3;
                updateEnergyText(3);
                
                alert('ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ë°±ì—…)
        function exportData() {
            try {
                const dataStr = localStorage.getItem('dietDiary');
                if (!dataStr) {
                    alert('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const data = JSON.parse(dataStr);
                const exportData = {
                    ...data,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                    type: 'application/json' 
                });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `diet-diary-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('ë°ì´í„°ê°€ ë‹¤ìš´ë¡œë“œ í´ë”ì— ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³µì›)
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // ë°±ì—… íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
                    if (!importedData.meals && !importedData.weeklyPlan) {
                        alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°±ì—… íŒŒì¼ì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    // ê¸°ì¡´ ë°ì´í„° ë®ì–´ì“°ê¸° í™•ì¸
                    if (localStorage.getItem('dietDiary')) {
                        if (!confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            return;
                        }
                    }
                    
                    localStorage.setItem('dietDiary', JSON.stringify(importedData));
                    loadData();
                    alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                } catch (error) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (ì„ íƒì‚¬í•­)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        saveData();
                        break;
                    case '1':
                        e.preventDefault();
                        switchTab('daily');
                        break;
                    case '2':
                        e.preventDefault();
                        switchTab('weekly');
                        break;
                }
            }
        });

        // PWA ì§€ì›ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (ì„ íƒì‚¬í•­)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ íŒŒì¼ì„ ë§Œë“¤ì–´ ë“±ë¡
                console.log('PWA ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ êµ¬í˜„í•˜ì„¸ìš”.');
            });
        }

        // í„°ì¹˜ ì œìŠ¤ì²˜ ì§€ì› (ëª¨ë°”ì¼)
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ì£¼ê°„ ê³„íšìœ¼ë¡œ
                    switchTab('weekly');
                } else {
                    // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ë°ì¼ë¦¬ë¡œ
                    switchTab('daily');
                }
            }
        }

        // ë°˜ì‘í˜• ë””ìì¸ì„ ìœ„í•œ í™”ë©´ í¬ê¸° ê°ì§€
        function handleResize() {
            const isMobile = window.innerWidth < 768;
            
            if (isMobile) {
                // ëª¨ë°”ì¼ì—ì„œëŠ” í…Œì´ë¸”ì„ ì¹´ë“œ í˜•íƒœë¡œ ë³€ê²½ (ì„ íƒì‚¬í•­)
                document.querySelectorAll('.glass-card').forEach(card => {
                    card.style.margin = '0.5rem 0';
                });
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // ì´ˆê¸° ì‹¤í–‰

        // ë‹¤í¬ ëª¨ë“œ í† ê¸€ (ì„ íƒì‚¬í•­)
        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            localStorage.setItem('darkMode', isDark);
        }

        // ë‹¤í¬ ëª¨ë“œ ì„¤ì • ë¡œë“œ
        function loadDarkMode() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark');
            }
        }

        // ì•Œë¦¼ ë° ë¦¬ë§ˆì¸ë” ê¸°ëŠ¥ (ì„ íƒì‚¬í•­)
        function setReminder() {
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    if (permission === 'granted') {
                        // ì‹ì‚¬ ì‹œê°„ ì•Œë¦¼ ì„¤ì •
                        const now = new Date();
                        const nextMealTime = new Date(now);
                        nextMealTime.setHours(12, 0, 0, 0); // ì ì‹¬ ì‹œê°„ ì˜ˆì‹œ
                        
                        if (nextMealTime > now) {
                            const timeUntilMeal = nextMealTime.getTime() - now.getTime();
                            setTimeout(function() {
                                new Notification('ğŸ½ï¸ ì‹ì‚¬ ì‹œê°„ì´ì—ìš”!', {
                                    body: 'ì˜¤ëŠ˜ì˜ ì‹ì‚¬ë¥¼ ê¸°ë¡í•´ë³´ì„¸ìš”.',
                                    icon: '/icon-192x192.png' // ì‹¤ì œ ì•„ì´ì½˜ ê²½ë¡œ
                                });
                            }, timeUntilMeal);
                        }
                    }
                });
            }
        }

        // ì•± ì´ˆê¸°í™” ì‹œ ì•Œë¦¼ ì„¤ì •
        // setReminder(); // í•„ìš”ì‹œ ì£¼ì„ í•´ì œ
    </script>
</body>
</html>
